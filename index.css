import whisper
import os
from tkinter import Tk
from tkinter.filedialog import askopenfilename

# -------------------------
# 1. 選擇 MP3 檔
# -------------------------
Tk().withdraw()  # 隱藏 tkinter 主視窗
file_path = askopenfilename(
    title="Select MP3 file to transcribe",
    filetypes=[("MP3 files", "*.mp3")]
)

if not file_path:
    print("No file selected. Exiting...")
    exit()

# -------------------------
# 2. 載入 Whisper 模型
# -------------------------
print("Loading Whisper model (base) on GPU...")
model = whisper.load_model("base", device="cuda")  # 使用 GPU

# -------------------------
# 3. 轉錄 MP3 (英文)
# -------------------------
print(f"Transcribing '{os.path.basename(file_path)}'...")
result = model.transcribe(file_path, language="en", verbose=True)

# -------------------------
# 4. 生成同名 TXT 檔
# -------------------------
txt_path = os.path.splitext(file_path)[0] + ".txt"
with open(txt_path, "w", encoding="utf-8") as f:
    f.write(result["text"])

print(f"Transcription completed!\nSaved to: {txt_path}")
