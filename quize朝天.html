<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¬é©—é é¢</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>å–®å­—æ¸¬é©—</h1>
    <button class="back-button" onclick="goBack()">Back</button>

    <!-- æ¸¬é©—åˆ†é¡é¸æ“‡å€ï¼ˆä½¿ç”¨ä¸‹æ‹‰é¸å–®ï¼‰ -->
    <div id="categorySelection">
        <h3>é¸æ“‡æ¸¬é©—åˆ†é¡</h3>
        <select id="categoryDropdown" onchange="selectCategory()">
            <option value="">è«‹é¸æ“‡åˆ†é¡</option>
            <option value="all">å…¨éƒ¨</option>
        </select>
        <select id="levelDropdown" onchange="selectCategory()">
            <option value="">è«‹é¸æ“‡ç­‰ç´š</option>
            <option value="all">å…¨éƒ¨</option>
        </select>
    </div>

    <!-- æ¸¬é©—é–‹å§‹æŒ‰éˆ• -->
    <button class="button" id="startQuizBtn" onclick="startQuiz()">é–‹å§‹æ¸¬é©—</button>

    <!-- æ¸¬é©—å€åŸŸ -->
    <div id="quizContainer" style="display: none;">
        <h3 id="question"></h3>
        <button class="button" id="playAudioBtn" onclick="playAudio()" style="display: none;">ğŸ”Š æ’­æ”¾ç™¼éŸ³</button>
        <input type="text" id="answerInput" placeholder="è¼¸å…¥ç­”æ¡ˆ...">
        <button class="button" onclick="submitAnswer()">æäº¤ç­”æ¡ˆ</button>
        <p id="feedback"></p>
    </div>

    <!-- æ¸¬é©—çµæœå€åŸŸ -->
    <div id="resultContainer" style="display: none;">
        <h3>æ¸¬é©—çµæœ</h3>
        <p>ç¸½é¡Œæ•¸: <span id="totalQuestions"></span></p>
        <p>ç­”å°: <span id="correctAnswers"></span></p>
        <p>ç­”éŒ¯: <span id="wrongAnswers"></span></p>
        <button class="button" onclick="saveResults()">å„²å­˜çµæœ</button>
    </div>

    <script>
        let wordsData = [];
        let quizWords = [];
        let currentWord = null;

        document.addEventListener("DOMContentLoaded", function () {
            fetch("https://boydyang-designer.github.io/English-vocabulary/Z_total_words.json")
                .then(res => res.json())
                .then(data => {
                    wordsData = data["New Words"] || [];
                    populateCategoryDropdown();
                    populateLevelDropdown();
                })
                .catch(err => console.error("âŒ è®€å– JSON å¤±æ•—:", err));
        });

        function populateCategoryDropdown() {
            let categories = [...new Set(wordsData.map(w => w["åˆ†é¡"] || "æœªåˆ†é¡"))];
            let categoryDropdown = document.getElementById("categoryDropdown");
            categories.forEach(category => {
                let option = document.createElement("option");
                option.value = category;
                option.textContent = category;
                categoryDropdown.appendChild(option);
            });
        }

        function populateLevelDropdown() {
            let levels = [...new Set(wordsData.map(w => w["ç­‰ç´š"] || "æœªåˆ†é¡"))];
            let levelDropdown = document.getElementById("levelDropdown");
            levels.forEach(level => {
                let option = document.createElement("option");
                option.value = level;
                option.textContent = level;
                levelDropdown.appendChild(option);
            });
        }

        function selectCategory() {
            let category = document.getElementById("categoryDropdown").value;
            let level = document.getElementById("levelDropdown").value;
            if (category === "all" && level === "all") {
                quizWords = wordsData;
            } else if (category === "all") {
                quizWords = wordsData.filter(w => w["ç­‰ç´š"] === level);
            } else if (level === "all") {
                quizWords = wordsData.filter(w => w["åˆ†é¡"] === category);
            } else {
                quizWords = wordsData.filter(w => w["åˆ†é¡"] === category && w["ç­‰ç´š"] === level);
            }
        }

        function startQuiz() {
            if (quizWords.length === 0) {
                alert("è«‹å…ˆé¸æ“‡æ¸¬é©—åˆ†é¡æˆ–ç­‰ç´š");
                return;
            }
            document.getElementById("categorySelection").style.display = "none";
            document.getElementById("quizContainer").style.display = "block";
            nextQuestion();
        }

        function nextQuestion() {
            if (quizWords.length === 0) {
                showResults();
                return;
            }
            currentWord = quizWords.pop();
            document.getElementById("question").textContent = `å–®å­—æç¤º: ${currentWord.Words[0]} _ _ _ ${currentWord.Words.slice(-1)}`;
            document.getElementById("answerInput").value = "";
            document.getElementById("feedback").textContent = "";
            
            let playAudioBtn = document.getElementById("playAudioBtn");
            if (currentWord.Audio) {
                playAudioBtn.style.display = "block";
                playAudioBtn.setAttribute("data-audio", currentWord.Audio);
            } else {
                playAudioBtn.style.display = "none";
            }
        }

        function playAudio() {
            let audioSrc = document.getElementById("playAudioBtn").getAttribute("data-audio");
            if (audioSrc) {
                let audio = new Audio(audioSrc);
                audio.play();
            }
        }

        function submitAnswer() {
            let answer = document.getElementById("answerInput").value.trim();
            if (answer.toLowerCase() === currentWord.Words.toLowerCase()) {
                document.getElementById("feedback").textContent = "âœ… æ­£ç¢ºï¼";
            } else {
                document.getElementById("feedback").textContent = `âŒ éŒ¯èª¤ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯: ${currentWord.Words}`;
            }
            setTimeout(nextQuestion, 1000);
        }

        function showResults() {
            document.getElementById("quizContainer").style.display = "none";
            document.getElementById("resultContainer").style.display = "block";
        }

        function saveResults() {
            alert("æ¸¬é©—çµæœå·²å„²å­˜ï¼");
        }

        function goBack() {
            window.location.href = "index.html";
        }
    </script>
</body>
</html>
