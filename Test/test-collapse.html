<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>折疊面板測試</title>
    <style>
        :root {
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --radius-lg: 0.75rem;
            --radius-full: 9999px;
            --color-bg: #f7fafc;
            --color-bg-elevated: #ffffff;
            --color-border: #e2e8f0;
            --color-primary: #667eea;
            --color-text-primary: #2d3748;
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: sans-serif;
            background: var(--color-bg);
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .filter-group {
            border-radius: var(--radius-lg);
            overflow: hidden;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            margin-bottom: 1rem;
        }

        .filter-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--color-bg-elevated);
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
        }

        .filter-header:hover {
            background: var(--color-bg);
        }

        .filter-icon {
            font-size: 1.25rem;
            color: var(--color-primary);
        }

        .filter-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height var(--transition-slow);
            background: var(--color-bg-elevated);
        }

        .filter-content > div {
            padding: var(--spacing-md);
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }

        .category-button {
            padding: var(--spacing-sm) var(--spacing-md);
            background: white;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-full);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .category-button:hover {
            border-color: var(--color-primary);
        }

        .subcategory-wrapper {
            max-height: 0;
            overflow: hidden;
            transition: max-height var(--transition-slow);
            padding: 0 var(--spacing-md);
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }

        .subcategory-wrapper.expanded {
            padding: var(--spacing-sm) var(--spacing-md);
        }

        .debug-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border: 2px solid var(--color-primary);
            border-radius: 8px;
            padding: 1rem;
            font-size: 0.875rem;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <h1>折疊面板測試</h1>
    
    <div class="filter-group">
        <button type="button" class="filter-header">
            <span class="filter-title">主分類測試</span>
            <span class="filter-icon">+</span>
        </button>
        <div class="filter-content" id="testContent">
            <div id="primaryButtons">
                <button class="category-button" onclick="toggleSub(this, '分類A')">分類A</button>
                <button class="category-button" onclick="toggleSub(this, '分類B')">分類B</button>
                <button class="category-button" onclick="toggleSub(this, '分類C')">分類C</button>
            </div>
        </div>
    </div>

    <div class="debug-info">
        <strong>除錯資訊：</strong>
        <div id="debugLog"></div>
    </div>

    <script>
        // 次分類資料
        const subData = {
            '分類A': ['子分類A1', '子分類A2', '子分類A3'],
            '分類B': ['子分類B1', '子分類B2'],
            '分類C': ['子分類C1', '子分類C2', '子分類C3', '子分類C4']
        };

        // 記錄訊息
        function log(message) {
            const debugLog = document.getElementById('debugLog');
            const time = new Date().toLocaleTimeString();
            debugLog.innerHTML = `<div>[${time}] ${message}</div>` + debugLog.innerHTML;
            console.log(message);
        }

        // 主分類折疊功能
        document.querySelectorAll('.filter-header').forEach(header => {
            header.addEventListener('click', function() {
                const isActive = this.classList.contains('active');
                const content = this.nextElementSibling;
                const icon = this.querySelector('.filter-icon');
                
                log(`主分類點擊 - 當前狀態: ${isActive ? '展開' : '收合'}`);
                
                if (isActive) {
                    // 收合
                    const subs = content.querySelectorAll('.subcategory-wrapper');
                    subs.forEach(sub => sub.style.maxHeight = '0px');
                    
                    setTimeout(() => {
                        content.style.maxHeight = '0px';
                        log('主分類已收合');
                    }, 50);
                    
                    this.classList.remove('active');
                    icon.textContent = '+';
                } else {
                    // 展開
                    this.classList.add('active');
                    content.style.maxHeight = 'none';
                    const height = content.scrollHeight;
                    content.style.maxHeight = '0px';
                    content.offsetHeight;
                    
                    setTimeout(() => {
                        content.style.maxHeight = height + 'px';
                        log(`主分類已展開 - 高度: ${height}px`);
                    }, 10);
                    
                    icon.textContent = '−';
                }
            });
        });

        // 次分類切換
        function toggleSub(btn, categoryName) {
            const wrapperId = `sub-${categoryName}`;
            let wrapper = document.getElementById(wrapperId);
            
            if (!wrapper) {
                // 創建次分類
                wrapper = document.createElement('div');
                wrapper.className = 'subcategory-wrapper';
                wrapper.id = wrapperId;
                wrapper.style.maxHeight = '0px';
                
                const subs = subData[categoryName] || [];
                wrapper.innerHTML = subs.map(s => 
                    `<button class="category-button">${s}</button>`
                ).join('');
                
                btn.parentNode.insertBefore(wrapper, btn.nextSibling);
                log(`次分類 ${categoryName} 已創建`);
            }
            
            // 切換展開/收合
            const isExpanded = wrapper.style.maxHeight && wrapper.style.maxHeight !== '0px';
            
            if (isExpanded) {
                wrapper.style.maxHeight = '0px';
                log(`次分類 ${categoryName} 收合`);
            } else {
                const height = wrapper.scrollHeight;
                wrapper.style.maxHeight = height + 'px';
                log(`次分類 ${categoryName} 展開 - 高度: ${height}px`);
            }
            
            // 更新父容器高度
            setTimeout(() => {
                const parent = document.getElementById('testContent');
                if (parent) {
                    const currentMax = parent.style.maxHeight;
                    parent.style.maxHeight = 'none';
                    const newHeight = parent.scrollHeight;
                    parent.style.maxHeight = currentMax;
                    
                    setTimeout(() => {
                        parent.style.maxHeight = newHeight + 'px';
                        log(`父容器高度更新: ${newHeight}px`);
                    }, 10);
                }
            }, 50);
        }
    </script>
</body>
</html>
